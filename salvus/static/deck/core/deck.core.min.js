(function($,deck,document,undefined){var slides,current,$container,events={change:"deck.change",beforeInitialize:"deck.beforeInit",initialize:"deck.init"},options={},$d=$(document),updateStates=function(){var oc=options.classes,osc=options.selectors.container,old=$container.data("onSlide"),$all=$();$container.removeClass(oc.onPrefix+old).addClass(oc.onPrefix+current).data("onSlide",current);$("."+oc.current).parentsUntil(osc).removeClass(oc.childCurrent);slides[current].parentsUntil(osc).addClass(oc.childCurrent);$.each(slides,function(i,el){$all=$all.add(el)});$all.removeClass([oc.before,oc.previous,oc.current,oc.next,oc.after].join(" "));slides[current].addClass(oc.current);if(current>0){slides[current-1].addClass(oc.previous)}if(current+1<slides.length){slides[current+1].addClass(oc.next)}if(current>1){$.each(slides.slice(0,current-1),function(i,el){el.addClass(oc.before)})}if(current+2<slides.length){$.each(slides.slice(current+2),function(i,el){el.addClass(oc.after)})}},methods={init:function(elements,opts){var startTouch,tolerance,esp=function(e){e.stopPropagation()};options=$.extend(true,{},$[deck].defaults,opts);slides=[];current=0;$container=$(options.selectors.container);tolerance=options.touch.swipeTolerance;$d.trigger(events.beforeInitialize);$container.addClass(options.classes.loading);if($.isArray(elements)){$.each(elements,function(i,e){slides.push($(e))})}else{$(elements).each(function(i,e){slides.push($(e))})}$d.unbind("keydown.deck").bind("keydown.deck",function(e){if(e.which===options.keys.next||$.inArray(e.which,options.keys.next)>-1){methods.next();e.preventDefault()}else if(e.which===options.keys.previous||$.inArray(e.which,options.keys.previous)>-1){methods.prev();e.preventDefault()}}).undelegate("input, textarea, select, button, meter, progress, [contentEditable]","keydown",esp).delegate("input, textarea, select, button, meter, progress, [contentEditable]","keydown",esp);$container.unbind("touchstart.deck").bind("touchstart.deck",function(e){if(!startTouch){startTouch=$.extend({},e.originalEvent.targetTouches[0])}}).unbind("touchmove.deck").bind("touchmove.deck",function(e){$.each(e.originalEvent.changedTouches,function(i,t){if(startTouch&&t.identifier===startTouch.identifier){if(t.screenX-startTouch.screenX>tolerance||t.screenY-startTouch.screenY>tolerance){$[deck]("prev");startTouch=undefined}else if(t.screenX-startTouch.screenX<-1*tolerance||t.screenY-startTouch.screenY<-1*tolerance){$[deck]("next");startTouch=undefined}return false}});e.preventDefault()}).unbind("touchend.deck").bind("touchend.deck",function(t){$.each(t.originalEvent.changedTouches,function(i,t){if(startTouch&&t.identifier===startTouch.identifier){startTouch=undefined}})}).scrollLeft(0).scrollTop(0);$.each(slides,function(i,$el){$el.unbind("webkitTransitionEnd.deck").bind("webkitTransitionEnd.deck",function(event){if($el.hasClass($[deck]("getOptions").classes.current)){var embeds=$(this).find("iframe").css("opacity",0);window.setTimeout(function(){embeds.css("opacity",1)},100)}})});if(slides.length){updateStates()}$container.removeClass(options.classes.loading);$d.trigger(events.initialize)},go:function(index){var e=$.Event(events.change),ndx;if(typeof index==="number"&&index>=0&&index<slides.length){ndx=index}else if(typeof index==="string"){$.each(slides,function(i,$slide){if($slide.attr("id")===index){ndx=i;return false}})}if(typeof ndx==="undefined")return;$d.trigger(e,[current,ndx]);if(e.isDefaultPrevented()){$d.trigger(events.change,[ndx,current])}else{current=ndx;updateStates()}},next:function(){methods.go(current+1)},prev:function(){methods.go(current-1)},getSlide:function(index){var i=typeof index!=="undefined"?index:current;if(typeof i!="number"||i<0||i>=slides.length)return null;return slides[i]},getSlides:function(){return slides},getContainer:function(){return $container},getOptions:function(){return options},extend:function(name,method){methods[name]=method}};$[deck]=function(method,arg){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{return methods.init(method,arg)}};$[deck].defaults={classes:{after:"deck-after",before:"deck-before",childCurrent:"deck-child-current",current:"deck-current",loading:"deck-loading",next:"deck-next",onPrefix:"on-slide-",previous:"deck-previous"},selectors:{container:".deck-container"},keys:{next:[13,32,34,39,40],previous:[8,33,37,38]},touch:{swipeTolerance:60}};$d.ready(function(){$("html").addClass("ready")});$d.bind("deck.change",function(e,from,to){var oldFrames=$[deck]("getSlide",from).find("iframe"),newFrames=$[deck]("getSlide",to).find("iframe");oldFrames.each(function(){var $this=$(this),curSrc=$this.attr("src");if(curSrc){$this.data("deck-src",curSrc).attr("src","")}});newFrames.each(function(){var $this=$(this),originalSrc=$this.data("deck-src");if(originalSrc){$this.attr("src",originalSrc)}})})})(jQuery,"deck",document);